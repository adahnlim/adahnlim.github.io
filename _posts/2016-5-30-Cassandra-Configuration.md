---	
layout: post
title:  Cassandra 3.x Configuration
description: Cassandra 3.x Configuration Properties 
tags: cassandra-properties
---


**Cassandra.yaml**


- Quick Start  
  클러스터를 구성하기기 위한 가장 기본적인 항목이다.


| 항목                         | 디폴트값                                                                              | 설명                                                                                                                                                                                                            |
|------------------------------|---------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| cluster_name                 | Test Cluster                                                                          | Cluster이름. 클러스터의 모든 노드들은 동일한 값을 가져야한다.                                                                                                                                                   |
| listen_address               | localhost                                                                             | 노드들과 통신하기 위한 IP 또는 Hostname<br>- 값이 비어있으면 내부적으로 InetAddress.getLocalhost()를 호출한다.<br>- Single Node Cluster이면 Default(localhost)를 사용한다.<br>- 0.0.0.0은 절대로 사용하지 말라. |
| listen_interface             | eth0                                                                                  | 노드들과 통신하기 위한 Interface                                                                                                                                                                                |
| listen_interface_prever_ipv6 | false                                                                                 | Interface에 ipv4와 ipv6 IP를 둘다 가지고 있으면 먼저 ipv4 address를 사용한다. true면 ipv6 address를 먼저 사용                                                                                                   |
| commitlog_directory          |                                                                                       | commit log를 저장하기 위한 디렉토리<br> - Write성능을 위해 commit log와 datafile 디렉토리를 분리시키는것이 좋다. commit log는 append만 수행                                                                     |
| data_file_directory          | package : /var/lib/cassandra/data <br>tarball : install_loc/data/data                 | SSTable이 저장되는 디렉토리 리스트                                                                                                                                                                              |
| saved_caches_directory       | package : /var/lib/cassandra/saved_caches <br>tarball : install_loc/data/saved_caches | table key와 row caches를 저장하는 디렉토리                                                                                                                                                                      |                                                  |


- Commonly Used Properties  
  많이 사용되는 항목이다.

| 항목                                            | 디폴트값                                              | 설명                                                                                                                                                                                                                                                                                                                                                                                    |
|-------------------------------------------------|-------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| commit_failure_polcy                            | stop                                                  | commit disk가 fail났을때의 정책.<br>- die : gossip/Thrift/JVM Shutdown. node가 교체될수 있다.<br>- stop : gossip/Thrift가 Shutdown되지만 JMX에 의해 모니터링할 수 있다.<br>- stop_commit : commit_log Shutdown되지만 read service는 가능<br>- ignore : error가 무시된다.                                                                                                                |
| disk_optimization_strategy                      | ssd                                                   | Disk read 최적화 할수 있는 전략(ssd or spinning)                                                                                                                                                                                                                                                                                                                                        |
| disk_failure_policy                             | stop                                                  | disk가 fail났을때의 정책.<br>- die : gossip/Thrift/JVM Shutdown. node가 교체될수 있다.<br>- stop_paranoid : gossip/Thrift Shutdown. single SSTable 에러<br>- stop : gossip/Thrift가 Shutdown되지만 JMX에 의해 모니터링할 수 있다.<br>- best_effort : failed disk 사용을 중지하고 남아있는 SSTable에게 요청한다. 정확하지않은 데이터를 응답받을 수 있다.<br>- ignore : error가 무시된다. |
| endpoint_snitch                                 | SimpleSnitch                                          | node의 위치판별과 요청에 대한 Routing을 위한 정책.<br>- SimpleSnitch, GossipingPropertyFileSnitch(Recommend), Ec2Snitch, Ec2MultiRegionSnitch, RackInferringSnitch, GoogleCloudSnitch, CloudstackSnitch등을 이용할 수 있다.                                                                                                                                                             |
| rpc_address                                     | localhost                                             | Client와의 통신을 위한 address.<br> - unset : /etc/hostname와 /etc/hosts 또는 DNS를 이용하여 매핑<br>- 0.0.0.0 : 모든 Interface에 대해 응답(단, broad_rpc_address는 0.0.0.0이 아닌 다른 값을 써야한다.<br>- IP address<br>- hostname                                                                                                                                                    |
| rpc_interface                                   | eth1                                                  | Client와의 통신을 위한 Interface                                                                                                                                                                                                                                                                                                                                                        |
| rpc_interface_prefer_ipv6                       | false                                                 | Interface에 ipv4와 ipv6 IP를 둘다 가지고 있으면 먼저 ipv4 address를 사용한다. true면 ipv6 address를 먼저 사용                                                                                                                                                                                                                                                                           |
| seed_provider                                   | class_name : SimpleSeedProvider<br>-seeds : 127.0.0.1 | Cassandra에서 -seeds 의 리스트를 이용해 서로 찾고 링의 토폴로지를 학습한다.<br>-seeds는 컴마(,)로 나열하며 모든노드를 seednode로 하는것은 gosship의 성능을 떨어뜨리기 때문에 추천하지 않고 데이터센터당 3node 이하로 유지하는것이 좋다.                                                                                                                                                 |
| enable_user_defined_functions                   | false                                                 | UDF(User Defined Function)는 서버측에서 실행되어 보안에 취약할 수 있다. Cassandra3.0이상에서는 UDF가 Sandbox형태로 실행된다.                                                                                                                                                                                                                                                            |
| enable_scripted_user_defined_functions          | false                                                 | javascript 또는 custom JSR-233 Provider가 실행 될 수 있다.                                                                                                                                                                                                                                                                                                                              |
| compation_throughput_mb_per_sec                 | 16                                                    | compaction에 사용하는 throughput의 임계값을 설정. 16~32가 권장되며 0은 제한을 걸지 않는다는 의미이다.                                                                                                                                                                                                                                                                                   |
| compaction_large_partition_warning_threshold_mb | 100                                                   | 설정된 값 이상의 파티션의 Compaction이 수행될때 Warning 로그를 남긴다.                                                                                                                                                                                                                                                                                                                  |
| concurrent_reads                                | 32                                                    | data를 Disk에서 읽을때 병목이 발생하므로 동시 Read수를 조절. 16*드라브갯수로 설정하는것이 좋다.                                                                                                                                                                                                                                                                                         |
| concurrent_writes                               | 32                                                    | writerk 수행될때 드물게 I/O Bound가 발생할 수 있어 CPU core*8이 권장된다.                                                                                                                                                                                                                                                                                                               |
| concurrent_counter_writes                       | 32                                                    | incremental값등을 저장하기 위한 Counter Cache사이즈. 16*drive갯수만큼 권장                                                                                                                                                                                                                                                                                                              |
| concurrent_batchlog_writes                      | 32                                                    | 동시 batchlog Write의 Limit( concurrent_write와 비슷하다.)                                                                                                                                                                                                                                                                                                                              |
| concurrent_materialized_view_writes             | 32                                                    | materialize view write는 concurrent_read나 concurrent_write보다 적어야 한다. materialized view writes에 read가 관여하기 때문이다.                                                                                                                                                                                                                                                       |
| incremental_backups                             | false                                                 | Cassandra는 SSTable이 Flush될때나 backups/의 서브디렉토리에 스트리밍될때 hard link를 만든다.                                                                                                                                                                                                                                                                                            |
| snapshot_before_compaction                      | false                                                 | Compaction 수행전에 snapshot을 수행할지 여부.                                                                                                                                                                                                                                                                                                                                           |
| phi_convict_threshold                           | 8                                                     | failure를 감지하는 민감도 조절. 보통 이 설정은 조절이 필요없다.                                                                                                                                                                                                                                                                                                                         |

- Performance Tuning Properties  
  System Resource Utilization(Commit log, Compation, Memory, Disk I/O, CPU, Reads, Writes 등)을 튜닝하는 항목이다.

| 항목                                                | 디폴트값                                  | 설명                                                                                                                                   |
|-----------------------------------------------------|-------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| commitlog_sync                                      | periodict:10000 milisec<br>batch:disabled | commitlog를 disk에 동기화시키는 주기                                                                                                   |
| commitlog_segment_size_in_mb                        | 32MB                                      | 개별 commitlog 파일의 segment사이즈.                                                                                                   |
| commitlog_compression                               | not enabled                               | commlitlog 압축 방식 : LZ4, snappy, deflate                                                                                            |
| commitlog_total_space_in_mb                         | 32bit JVM : 32MB<br>64bit JVM : 8192MB    | commitlog의 Total Space. space가 넘어가면 memtable를 flush하고 오래된 commitlog segment를 삭제한다.                                    |
| concurrent_compactors                               | Disk수와 core수중 작은값                  | 동시 수행되는 compaction process 수.                                                                                                   |
| memtable_allocation_type                            | heap_buffers                              | memtable memory를 할당하고 관리하는 방식.                                                                                              |
| memtable_cleanup_threshold                          | 0.11                                      | memtable flushing trigger를 위한 total size 대비 non_flushing memtable size 비율 임계치                                                |
| file_cache_size_in_mb                               | 1/4 heap or 512 중 작은값                 | SSTable Reading Buffer의 메모리사이즈                                                                                                  |
| buffer_pool_use_heap_if_exhausted                   | true                                      | off-heap을 할당할수 있는지의 여부(file_cache_size_in_mb를 초과했을때)                                                                  |
| memtable_flush_writers                              | disk수 또는 core수중 작은값 (2~8)         | memtable flush writer thread 수. 이 thread는 disk I/O를 block한다.                                                                     |
| memtable_heap_space_in_mb                           | 1/4heap                                   | memtable을 위한 메모리 허용치.                                                                                                         |
| memtable_offheap_space_in_mb                        | 1/4heap                                   | memtable을 위한 offheap 메모리 허용치.                                                                                                 |
| column_index_size_in_kb                             | 64                                        | 파티션내의 행 인덱스사이즈                                                                                                             |
| index_summary_capacity_in_mb                        | 0.05*heap                                 | SStable Index Summaries를 위한 메모리 풀 사이즈                                                                                        |
| index_summary_resize_interval_in_minutes            | 60min                                     | Index Summaries 재 수행 빈도                                                                                                           |
| stream_throuhput_outbound_megabits_per_sec          | 200                                       | 모든 out bound throughput 임계치                                                                                                       |
| inter_dc_stream_throuhput_outbound_megabits_per_sec | unset                                     | 데이터센터간 모든 스트리밍 파일 전송 임계치                                                                                            |
| trickle_fsync                                       | false                                     | sequantial Write가 수행될때 이 옵션을 enable하면 dirty_buffer( trickle_fsync_interval_in_kb에 설정된 값)를 OS에서 강제로 flushing한다. |
| trickle_fsync_interval_in_kb                        | 10240                                     | fsync 사이즈                                                                                                                           |
| windows_timer_interval                              | 1                                         |                                                                                                                                        |
